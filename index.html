<!DOCTYPE html>
<html>
<head>
    <title>My Template</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- <div class="container vh-100 d-flex justify-content-center position-absolute"> -->
        <!-- <div id="progress" class="h-100 d-flex position-fixed align-items-center"> -->
            <!-- <div class="d-flex flex-column"> -->
                <!-- <h1 class="text-light">Game is loading:</h1> -->
                <!-- <div class="progress mt-4"> -->
                    <!-- <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" -->
                        <!-- id="progressBar"></div> -->
                <!-- </div> -->
            <!-- </div> -->
        <!-- </div> -->

        <div class="container-fluid vh-100 d-flex justify-content-center align-items-center">
        
            <div id="gameDiv" class="position-fixed">
                <canvas id="canvas" class="d-none"></canvas>
            </div>
        
            <div id="progress" class="h-100 d-flex position-fixed align-items-center">
            <div class="d-flex flex-column">
                <h1 class="text-light">Game is loading:</h1>
                <div class="progress mt-4">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"
                        id="progressBar"></div>
                </div>
            </div>
            </div>
        
            <div id="lobby" class="vh-100 position-fixed d-flex d-none">
                <div class="h-100 d-flex flex-column">
                    <div class="h-25 d-flex justify-content-center">
                        <div class="d-flex flex-column p-2 justify-content-end">
                            <h3 class="display-2 text-light">Připojení hráči:</h3>
                        </div>
                    </div>
                    <div class="h-25">
                        <div class="d-flex flex-column">
                            <div class="text-center" id="listOfNames">
                             </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="StartGame()">Spustit hru</button>
                    <div class="h-50 container">
                        <div class="d-flex flex-column">
                            <div class="text-center">
                                <h3 class="display-6 text-light">Nech svého partnera naskenovat tento kód.</h3>
                                <img id="qrImage" class="img-thumbnail" crossorigin="anonymous" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=asrda"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <script src="index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var engine = new Engine({"args":[],"canvasResizePolicy":1,"executable":"index","experimentalVK":false,"fileSizes":{"index.pck":68226144,"index.wasm":17867504},"focusCanvas":true,"gdnativeLibs":[]});
        var game_started = false
            
        var search_params = new URLSearchParams(window.location.search)
        if (search_params.has("networkGameId"))
        {
            var networkGameId = search_params.get("networkGameId")
            var qrImage = document.getElementById("qrImage")
            qrImage.setAttribute("src", "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" + networkGameId)

            SetNameButton()
        }
        else{
            console.log("Error: Cannot load the IP correctly.")
        }

        function StartGame()
        {
            console.log("hidden")
            var lobby = document.getElementById("lobby")
            lobby.classList.add("d-none")

            var game = document.getElementById("canvas")
            game.classList.remove("d-none")
        }

        function IsStartGamePressed()
        {
            console.log("Game started: ", game_started)
            var game = document.getElementById("canvas")
        
            // Check if the game is visible.
            if(!game.classList.contains("d-none") && !game_started)
            {
                game_started = true;
                return true;
            }
            return false;
        }

        function AddNameToListOfNames(name)
        {
             var myDiv = document.getElementById("listOfNames");
            // Create an h2 element
            var newH2 = document.createElement('h4');
            // Set the text content of the h2 element
            newH2.textContent = name;
            newH2.setAttribute("class", "display-6 text-light justify-content-center p-2")
            // Append the h2 element to the div
            myDiv.appendChild(newH2);
        }

        function printProgress(current, total) 
        {
            const progressPercentage = ((current / total) * 100).toFixed(2);
            const progressBar = document.getElementById("progressBar");
            progressBar.style.width = `${progressPercentage}%`;
            progressBar.setAttribute("aria-valuenow", progressPercentage);
            progressBar.innerHTML = `${progressPercentage}% Complete`;
        }

        function OnLoadingFinished()
        {
                var progress = document.getElementById("progress")
                progress.classList.add("d-none")
            
                var lobby = document.getElementById("lobby")
                lobby.classList.remove("d-none")
        }

        function SetNameButton()
        {
            var canEl = document.getElementById("canvas")
            canEl.width  = window.innerWidth;
            canEl.height = window.innerHeight;
            engine.startGame({ onProgress: printProgress, canvas: canEl, canvasResizePolicy : 0 });
        }

        function copyURLToClipboard() 
        {
            const urlToCopy = window.location.href;
            const el = document.createElement("textarea");
            el.value = urlToCopy;
            el.setAttribute("readonly", "");
            el.style.position = "absolute";
            el.style.left = "-9999px";
            document.body.appendChild(el);
            el.select();
            document.execCommand("copy");
            document.body.removeChild(el);
            alert("URL copied to clipboard!");
        }

        function toggleFullScreen() 
        {
            const elem = document.getElementById("canvas");
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            }
        }
    </script>
</body>
<style>
    body {
      /* min-height: 100vh; */
      /* display: flex; */
      /* justify-content: center; */
      /* align-items: center; */
      background-color: #000000;
    }
</style>
</html>
